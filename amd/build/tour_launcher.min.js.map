{"version":3,"file":"tour_launcher.min.js","sources":["../src/tour_launcher.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tour launcher for the adaptive course audit plugin.\n *\n * Detects the `startacatour` URL parameter and starts the specified tour\n * programmatically, bypassing the normal Moodle tour matching which only\n * starts the first matching tour per page.\n *\n * Delegates to tool_usertours/usertours init() so that all event handling\n * (markStepShown, markTourComplete, reset link, resize) is handled by\n * Moodle core.\n *\n * @module     local_adaptive_course_audit/tour_launcher\n * @copyright  2026 Moodle HQ\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport {init as usertourInit} from 'tool_usertours/usertours';\n\n/**\n * Extract and remove the startacatour parameter from the URL.\n *\n * @returns {number|null} The tour ID, or null if not present.\n */\nconst extractTourIdFromUrl = () => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const raw = urlParams.get('startacatour');\n    if (!raw) {\n        return null;\n    }\n\n    const parsed = parseInt(raw, 10);\n    if (isNaN(parsed) || parsed <= 0) {\n        return null;\n    }\n\n    // Remove the parameter from the address bar without reloading.\n    urlParams.delete('startacatour');\n    const search = urlParams.toString();\n    const cleaned = window.location.pathname + (search ? '?' + search : '') + window.location.hash;\n    window.history.replaceState(null, '', cleaned);\n\n    return parsed;\n};\n\n/**\n * Entry point: detect URL parameter and launch tour after a short delay.\n */\nexport const init = () => {\n    const id = extractTourIdFromUrl();\n    if (!id) {\n        return;\n    }\n\n    // Short delay so the normal Moodle bootstrap can run first;\n    // usertourInit() will end any competing tour before starting ours.\n    window.setTimeout(() => {\n        usertourInit([{tourId: id, startTour: true, filtervalues: {}}], []);\n    }, 500);\n};\n"],"names":["id","urlParams","URLSearchParams","window","location","search","raw","get","parsed","parseInt","isNaN","delete","toString","cleaned","pathname","hash","history","replaceState","extractTourIdFromUrl","setTimeout","tourId","startTour","filtervalues"],"mappings":"oNA6DoB,WACVA,GAzBmB,YACnBC,UAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QAChDC,IAAML,UAAUM,IAAI,oBACrBD,WACM,WAGLE,OAASC,SAASH,IAAK,OACzBI,MAAMF,SAAWA,QAAU,SACpB,KAIXP,UAAUU,OAAO,sBACXN,OAASJ,UAAUW,WACnBC,QAAUV,OAAOC,SAASU,UAAYT,OAAS,IAAMA,OAAS,IAAMF,OAAOC,SAASW,YAC1FZ,OAAOa,QAAQC,aAAa,KAAM,GAAIJ,SAE/BL,QAOIU,GACNlB,IAMLG,OAAOgB,YAAW,yBACD,CAAC,CAACC,OAAQpB,GAAIqB,WAAW,EAAMC,aAAc,KAAM,MACjE"}