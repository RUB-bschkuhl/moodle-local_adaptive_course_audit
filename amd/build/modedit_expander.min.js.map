{"version":3,"file":"modedit_expander.min.js","sources":["../src/modedit_expander.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Expands relevant collapsible fieldsets on modedit.php.\n *\n * This ensures usertour step targeting works even when settings sections are collapsed.\n *\n * @module     local_adaptive_course_audit/modedit_expander\n * @copyright  2026 Moodle HQ\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Expand the closest collapsible fieldset for an element.\n *\n * @param {Element} el\n */\nconst expandClosestCollapsibleFieldset = (el) => {\n    const fieldset = el.closest('fieldset.collapsible');\n    if (!fieldset) {\n        return;\n    }\n\n    const toggler = fieldset.querySelector('a.fheader[aria-controls]');\n    if (!toggler) {\n        return;\n    }\n\n    // Moodle form headers use Bootstrap-style collapse where the real state lives on the\n    // controlled container div (e.g. #id_timingcontainer) rather than on the fieldset.\n    const controlsId = toggler.getAttribute('aria-controls');\n    const container = controlsId ? document.getElementById(controlsId) : null;\n\n    if (container && !container.classList.contains('show')) {\n        // Force expanded state without relying on Bootstrap JS being ready.\n        container.classList.add('show');\n        container.classList.remove('collapsing');\n        container.style.height = '';\n\n        toggler.classList.remove('collapsed');\n        toggler.setAttribute('aria-expanded', 'true');\n        fieldset.classList.remove('collapsed');\n        return;\n    }\n\n    // Fallback: if we couldn't resolve the container, try the native click.\n    const expanded = toggler.getAttribute('aria-expanded');\n    if (expanded === 'false') {\n        toggler.click();\n    }\n};\n\nconst expandRelevantFieldsets = () => {\n    const selectors = [\n        '#id_preferredbehaviour',\n        '#id_attempts',\n        '#id_grademethod',\n        '#id_attemptimmediately',\n        '[id^=\"fitem_id_feedbacktext\"]',\n        '#id_timeopen',\n        '#id_quizpassword',\n    ];\n\n    selectors.forEach((selector) => {\n        const el = document.querySelector(selector);\n        if (!el) {\n            return;\n        }\n        expandClosestCollapsibleFieldset(el);\n    });\n};\n\nexport const init = () => {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            expandRelevantFieldsets();\n            window.setTimeout(expandRelevantFieldsets, 150);\n        });\n        return;\n    }\n\n    expandRelevantFieldsets();\n    window.setTimeout(expandRelevantFieldsets, 150);\n};\n\n"],"names":["expandRelevantFieldsets","forEach","selector","el","document","querySelector","fieldset","closest","toggler","controlsId","getAttribute","container","getElementById","classList","contains","add","remove","style","height","setAttribute","click","expandClosestCollapsibleFieldset","readyState","window","setTimeout","addEventListener"],"mappings":";;;;;;;;;;MAiEMA,wBAA0B,KACV,CACd,yBACA,eACA,kBACA,yBACA,gCACA,eACA,oBAGMC,SAASC,iBACTC,GAAKC,SAASC,cAAcH,UAC7BC,IAhD6BA,CAAAA,WAChCG,SAAWH,GAAGI,QAAQ,4BACvBD,sBAICE,QAAUF,SAASD,cAAc,gCAClCG,qBAMCC,WAAaD,QAAQE,aAAa,iBAClCC,UAAYF,WAAaL,SAASQ,eAAeH,YAAc,QAEjEE,YAAcA,UAAUE,UAAUC,SAAS,eAE3CH,UAAUE,UAAUE,IAAI,QACxBJ,UAAUE,UAAUG,OAAO,cAC3BL,UAAUM,MAAMC,OAAS,GAEzBV,QAAQK,UAAUG,OAAO,aACzBR,QAAQW,aAAa,gBAAiB,aACtCb,SAASO,UAAUG,OAAO,aAMb,UADAR,QAAQE,aAAa,kBAElCF,QAAQY,SAoBRC,CAAiClB,sBAIrB,KACY,YAAxBC,SAASkB,YAQbtB,0BACAuB,OAAOC,WAAWxB,wBAAyB,MARvCI,SAASqB,iBAAiB,oBAAoB,KAC1CzB,0BACAuB,OAAOC,WAAWxB,wBAAyB"}